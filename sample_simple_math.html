<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>SimpleMath</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="style.css">
		<style>
			table.master, th.master, td.master {
				border: 1px solid black;
			}
			input[type=number] {
				text-align:right;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row justify-content-center">
				<div class="col-8">
					<div class="jumbotron mt-2">
						<h1 class="display-4">Simple Math</h1>
						<p class="lead">The clock starts when focus moves away from the first problem entry<br>The clock stops when all problems are answered correctly</p>
					  </div>
				</div>
			</div>
		</div>
		<table id="test" class="master">
			<thead>
				<tr>
					<th class="master">Start Time:</th>
					<th class="master">End Time:</th>
					<th class="master">Difference in Seconds:</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td class="master">
						<div id="startTime">&nbsp;</div>
					</td>
					<td class="master">
						<div id="endTime">&nbsp;</div>
					</td>
					<td class="master">
						<table>
							<tr>
								<td>&nbsp;</td>
								<td>&nbsp;</td>
								<td>&nbsp;</td>
								<td>&nbsp;</td>
								<td>&nbsp;</td>
								<td>&nbsp;</td>
								<td>
									<div id="timeDiff">&nbsp;</div>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</tbody>
		</table>
		<table class="master">
			<tr class="master">
				<td class="master">
					<table class="problem" id="problem_1">
						<tr>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>8</td>
						</tr>
						<tr>
							<td>&nbsp;</td>
							<td>&#xf7;</td>
							<td>2</td>
						</tr>
						<tr>
							<td colspan="3" class="master">
								<input class="entry" id="entry_1" type="number">
							</td>
						</tr>
						<tr>
							<td colspan="3">
								<input type="hidden" class="result" id="result_1" value="4">
							</td>
						</tr>
					</table>
				</td>
				<td class="master">
					<table class="problem" id="problem_2">
						<tr>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>12</td>
						</tr>
						<tr>
							<td>&nbsp;</td>
							<td>&#xf7;</td>
							<td>3</td>
						</tr>
						<tr>
							<td colspan="3" class="master">
								<input class="entry" id="entry_2" type="number">
							</td>
						</tr>
						<tr>
							<td colspan="3">
								<input type="hidden" class="result" id="result_2" value="4">
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr class="master">
				<td class="master">
					<table class="problem" id="problem_3">
						<tr>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>36</td>
						</tr>
						<tr>
							<td>&nbsp;</td>
							<td>&#xf7;</td>
							<td>4</td>
						</tr>
						<tr>
							<td colspan="3" class="master">
								<input class="entry" id="entry_3" type="number">
							</td>
						</tr>
						<tr>
							<td colspan="3">
								<input type="hidden" class="result" id="result_3" value="9">
							</td>
						</tr>
					</table>
				</td>
				<td class="master">
					<table class="problem" id="problem_4">
						<tr>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>14</td>
						</tr>
						<tr>
							<td>&nbsp;</td>
							<td>&#xf7;</td>
							<td>7</td>
						</tr>
						<tr>
							<td colspan="3" class="master">
								<input class="entry" id="entry_4" type="number">
							</td>
						</tr>
						<tr>
							<td colspan="3">
								<input type="hidden" class="result" id="result_4" value="2">
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
		<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
		<script>
			$( document ).ready(function() {
				$('#entry_1').focus();
				let startTime = null;
				$('.entry').blur(function() {
					if(startTime == null){
						startTime =  new Date();
						let st = startTime.toLocaleTimeString();
						$("#startTime").html(st);
					}
					let entryID = this.id;
					let problemID = entryID.replace('entry','#problem');
					let resultID = entryID.replace('entry','result');
					let entryValue = document.getElementById(entryID).value;
					let resultValue = document.getElementById(resultID).value;
					if(parseInt(entryValue) == parseInt(resultValue)) {
						$(problemID).css("background-color","Aquamarine ");
						if(isComplete()){
							let resultElems = document.getElementsByClassName('result');
							let entryElems = document.getElementsByClassName('entry');
							let entryValues = [];
							$.each(entryElems, function( index, value ) {
								entryValues.push(value.value);
							});
							let resultValues = [];
							$.each(resultElems, function( index, value ) {
								resultValues.push(value.value);
							});
							if(arraysEqual(entryValues, resultValues)){
								let endTime = new Date();
							let et = endTime.toLocaleTimeString();
							$("#endTime").html(et);
							let timeDiff = endTime - startTime;
							$("#timeDiff").html(timeDiff/1000);
							}
						}
					}
				});

				function arraysEqual(a, b) {
					if (a === b) return true;
					if (a == null || b == null) return false;
					if (a.length != b.length) return false;
					for (let i = 0; i < a.length; ++i) {
						if (a[i] !== b[i]) return false;
					}
					return true;
				}

				function isComplete() {
					let isValid = true;
					$("input").each(function() {
						let element = $(this);
						if (element.val() == "") {
							isValid = false;
						}
					});
					return isValid;
				}
			});
		</script>
	</body>
</html>